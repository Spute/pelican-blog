# æ–‡ä»¶è·¯å¾„ï¼š.github/workflows/pelican.yml
# ç”¨é€”ï¼šåœ¨æ¨é€åˆ° main åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨æ„å»º Pelican é™æ€ç½‘ç«™ï¼Œå¹¶éƒ¨ç½²åˆ° Cloudflare Pages

name: Build and Deploy Pelican

on:
  push:
    branches: [ main ]   # ğŸš€ å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘æ„å»ºï¼ˆå¯æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰

jobs:
  build:
    runs-on: ubuntu-latest   # ğŸ’» ä½¿ç”¨æœ€æ–°çš„ Ubuntu ç¯å¢ƒä½œä¸ºæ„å»ºæœº

    steps:
      # ==============================
      # 1ï¸âƒ£ æ‹‰å–é¡¹ç›®ä»£ç ï¼ˆåŒ…å«ä¸»é¢˜å­æ¨¡å—ï¼‰
      # ==============================
      - name: Checkout repository (include submodules)
        uses: actions/checkout@v4
        with:
          submodules: true     # âœ… å…³é”®ï¼šç¡®ä¿ä¸»é¢˜ï¼ˆsubmoduleï¼‰ä¸€å¹¶è¢«ä¸‹è½½
          fetch-depth: 0       # å»ºè®®å®Œæ•´æ‹‰å–åˆ†æ”¯ä¿¡æ¯ï¼ˆæœ‰äº› Pelican æ’ä»¶ä¾èµ– git ä¿¡æ¯ï¼‰

      # ==============================
      # 2ï¸âƒ£ å®‰è£… Python ç¯å¢ƒ
      # ==============================
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'  # âš™ï¸ æŒ‡å®š Python ç‰ˆæœ¬

      # ==============================
      # 3ï¸âƒ£ å®‰è£… Pelican åŠä¾èµ–
      # ==============================
      - name: Install dependencies
        run: |
          pip install pelican markdown   # âœï¸ æ ¹æ®ä½ çš„é¡¹ç›®éœ€è¦ï¼Œä¹Ÿå¯ä»¥åŠ æ’ä»¶ä¾èµ–ï¼Œæ¯”å¦‚ pelican[markdown,typogrify]

      # ==============================
      # 4ï¸âƒ£ æ„å»º Pelican é™æ€ç½‘ç«™
      # ==============================
      - name: Build site
        run: |
          pelican content -o output -s pelicanconf.py
          # â¬†ï¸
          # content/          â†’ ä½ çš„ Markdown æˆ– rst æ–‡ä»¶ç›®å½•
          # output/           â†’ Pelican ç”Ÿæˆçš„é™æ€ç½‘ç«™è¾“å‡ºç›®å½•
          # pelicanconf.py    â†’ Pelican é…ç½®æ–‡ä»¶

      # ==============================
      # 5ï¸âƒ£ éƒ¨ç½²åˆ° Cloudflare Pages
      # ==============================
      - name: Deploy to Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CF_API_TOKEN }}     # ğŸ” ä» GitHub Secrets è¯»å– Cloudflare API Token
          accountId: ${{ secrets.CF_ACCOUNT_ID }}   # ğŸ” ä» GitHub Secrets è¯»å– Cloudflare Account ID
          projectName: pelican-blog                 # âš ï¸ æ›¿æ¢æˆä½ åœ¨ Cloudflare Pages çš„é¡¹ç›®å
          directory: ./output                       # ğŸŒ æŒ‡å®šè¦ä¸Šä¼ çš„é™æ€æ–‡ä»¶ç›®å½•ï¼ˆå³ Pelican è¾“å‡ºç›®å½•ï¼‰

      # âœ… å®Œæˆåï¼Œä½ ä¼šåœ¨ Cloudflare Pages æ§åˆ¶å°çœ‹åˆ°ä¸€æ¡æ–°éƒ¨ç½²è®°å½•
